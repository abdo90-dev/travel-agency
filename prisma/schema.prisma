datasource db {
  provider = "postgresql"
  url      = "postgresql://postgres:0675378571abdo_DZ@db.rqapiqffdyfhzpqypbom.supabase.co:5432/postgres?sslmode=require"
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id          Int       @id @default(autoincrement())
  full_name   String
  email       String    @unique
  password_hash String
  role        String    @default("customer")
  created_at  DateTime  @default(now())
  bookings    Booking[]
}

model Booking {
  id             Int       @id @default(autoincrement())
  user_id        Int
  booking_type   String
  provider       String?
  provider_ref   String?
  status         String    @default("pending")
  total_price    Float
  margin_applied Float
  created_at     DateTime  @default(now())
  updated_at     DateTime  @default(now())
  user           User      @relation(fields: [user_id], references: [id])
  passengers     Passenger[]
  payments       Payment[]
  invoices       Invoice[]
}

model Passenger {
  id              Int       @id @default(autoincrement())
  booking_id      Int
  first_name      String
  last_name       String
  email           String?   // ✅ add
  phone           String?   // ✅ add
  passport_number String?
  birth_date      DateTime?
  seat_choice     String?
  baggage_option  String?
  meal_option     String?
  booking         Booking   @relation(fields: [booking_id], references: [id])
}


model Payment {
  id                Int      @id @default(autoincrement())
  booking_id        Int
  stripe_payment_id String   @unique
  amount            Float
  currency          String   @default("EUR")
  status            String   @default("pending")
  created_at        DateTime @default(now())
  booking           Booking  @relation(fields: [booking_id], references: [id])
}

model Invoice {
  id              Int      @id @default(autoincrement())
  booking_id      Int
  invoice_number  String   @unique
  pdf_url         String?
  issued_at       DateTime @default(now())
  booking         Booking  @relation(fields: [booking_id], references: [id])
}

model ApiLog {
  id              Int      @id @default(autoincrement())
  provider        String
  endpoint        String
  request_payload Json
  response_payload Json
  status_code     Int
  created_at      DateTime @default(now())
}
